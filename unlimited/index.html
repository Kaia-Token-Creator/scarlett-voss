<!-- /unlimited/index.html : Footer Í≥†Ï†ï + ComposerÎ•º Ìï≠ÏÉÅ Ìë∏ÌÑ∞ ÏúÑÏóê -->
<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LFMWVGLLZD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LFMWVGLLZD');
</script>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Chat with scarlett ‚Äî Unlimited</title>
<meta name="theme-color" content="#000000" />
<style>
  :root{
    --bg:#000000;
    --hotpink:#ff1493;
    --text:#ff1493;
    --composerH: 58px; /* Ïä¨Î¶º ÏûÖÎ†•Ï∞Ω ÎÜíÏù¥ */
    --footerH: 0px;    /* CHANGED: JSÎ°ú Ìë∏ÌÑ∞ Ïã§Ï†ú ÎÜíÏù¥ Ï£ºÏûÖ */
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans", "Noto Sans KR", sans-serif;
  }
  header, footer{
    text-align:center;
    padding:20px 16px;
  }
  header{
    font-size:clamp(18px,3vw,28px);
    font-weight:700;
    letter-spacing:.3px;
  }
  footer{
    color:#ff7abb;
    font-size:14px;
    line-height:1.5;
    /* CHANGED: Ìï≠ÏÉÅ ÌôîÎ©¥ Îß® ÏïÑÎûò Í≥†Ï†ï */
    position:fixed; left:0; right:0; bottom:0;
    margin:0;                  /* Í∏∞Ï°¥ margin-bottom Ï†úÍ±∞ Ìö®Í≥º */
    background:#000; border-top:1px solid #222;
    z-index:5;
  }

  .shell{
    height:calc(100dvh - 160px);
    max-width:860px;
    margin:0 auto;
    display:flex; flex-direction:column; gap:12px;
    padding:0 12px 12px;
  }

  .toolbar{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:6px 2px;
  }
  .pill{
    border:1px solid #222; background:#0a0a0a; color:#fff;
    padding:8px 12px; border-radius:999px; font-size:13px; cursor:pointer;
  }

  .chat{
    flex:1; overflow:auto;
    display:flex; flex-direction:column; gap:14px;
    /* CHANGED: Ï¥àÍ∏∞Í∞í(ÏïÑÎûò JSÍ∞Ä Ïã§Ï†ú Í∞íÏúºÎ°ú ÎçÆÏñ¥ÏîÄ) */
    padding:6px 4px calc(var(--composerH) + 16px);
  }

  .row{ display:flex; align-items:flex-start; gap:10px; width:100%; }
  .row.assistant{ justify-content:flex-start; }
  .row.user{ justify-content:flex-start; flex-direction:row-reverse; }

  .avatar{
    width:38px; height:38px; border-radius:9999px; flex:0 0 38px; overflow:hidden;
    display:grid; place-items:center; background:#ffffff; color:#000; font-weight:700; font-size:12px;
    border:2px solid #ffffff22;
  }
  .avatar.assistant img{ width:100%; height:100%; object-fit:cover; display:block; }
  .avatar.user{ background:#fff; color:#000; }

  .bubble{
    max-width:min(85%, 680px);
    padding:12px 14px; border-radius:16px; line-height:1.5; word-wrap:break-word; white-space:pre-wrap;
    box-shadow:0 2px 8px rgba(0,0,0,.35);
    border:1px solid #ffffff10;
    font-size:16px;
  }
  .assistant .bubble{ background:var(--hotpink); color:#000; }
  .user .bubble{ background:#ffffff; color:#000; }

  /* floating ÏûÖÎ†•Ï∞Ω(Ïä¨Î¶º) */
  .composer{
    position:fixed; left:0; right:0;
    bottom:var(--footerH);           /* CHANGED: Ìë∏ÌÑ∞ ÎÜíÏù¥ÎßåÌÅº ÏúÑÎ°ú */
    height:var(--composerH);
    background:linear-gradient(180deg, rgba(0,0,0,0) 0%, #000 30%);
    padding:6px 10px;
    display:flex; align-items:center; justify-content:center;
    border-top:1px solid #222;
    z-index:6; /* Ìë∏ÌÑ∞Î≥¥Îã§ ÏÇ¥Ïßù ÏúÑ */
  }
  .composer .inner{
    width:100%; max-width:860px; height:100%;
    display:flex; align-items:center; gap:6px;
    background:#0a0a0a; border:1px solid #222; border-radius:999px; padding:6px;
  }
  #msg{
    flex:1; border:none; outline:none; background:transparent; color:#fff;
    font-size:15px; line-height:1.2; padding:6px 8px;
  }
  #send{
    background:var(--hotpink); color:#000; border:none; border-radius:999px;
    font-weight:800; padding:8px 12px;
    cursor:pointer;
  }
  #send:disabled{ opacity:.5; cursor:not-allowed; }

  /* ÎßÅÌÅ¨(Î∞ëÏ§Ñ) */
  .link{ color:#ff9cc3; text-decoration:underline; font-weight:600; cursor:pointer; }
  .link:hover{ opacity:.85; }

  /* Î™®Îã¨ */
  .modal{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.7); z-index:50; padding:16px; }
  .modal.show{ display:grid; }
  .modal-card{ width:min(520px, 96vw); background:#0a0a0a; color:#fff; border:1px solid #222; border-radius:16px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.6); }
  .modal h3{ margin:0 0 8px; color:var(--hotpink) }
  .modal p{ margin:0 0 12px; color:#e9e9e9 }
  .modal .rowx{ display:flex; gap:10px; align-items:center; margin:8px 0 16px }
  .modal input{ width:120px; padding:8px 10px; border-radius:10px; border:1px solid #333; background:#111; color:#fff; }
  .modal .close{ float:right; background:none; border:none; color:#aaa; font-size:20px; cursor:pointer; }
  .paypal-wrap{ margin-top:10px; }

  @media (max-width: 420px){
    header, footer{ padding:16px 12px; }
  }
</style>

<!-- PayPal JS SDK (client-id Í≥†Ï†ï) -->
<script src="https://www.paypal.com/sdk/js?client-id=AW41UQ3EzJV10FZHqYPy8yqdlDbklB4VjuT6hzu7DVoS-G9cJgKx9nHfxCRZpVSgs1dczhkPj4oM0VXv&currency=USD"></script>
</head>
<body>
  <header>Chat with scarlett</header>

  <main class="shell">
    <div class="toolbar">
      <div style="opacity:.8;font-size:13px">Unlimited conversation</div>
      <button id="clear" class="pill" title="Clear the conversation">Clear chat</button>
    </div>
    <section id="chat" class="chat" aria-live="polite"></section>
  </main>

  <!-- floating ÏûÖÎ†•Ï∞Ω -->
  <div class="composer">
    <div class="inner">
      <input id="msg" type="text" placeholder="Type your message‚Ä¶" autocomplete="off" />
      <button id="send">Send</button>
    </div>
  </div>

  <footer>
    <!-- ÎßÅÌÅ¨ 2Í∞ú (Î™®Îã¨ Ïò§Ìîà) -->
    <a id="tipLink" class="link" href="#" role="button">Want to tip Scarlett?</a><br/>
    <a id="galleryLink" class="link" href="#" role="button">Want to see Scarlett‚Äôs secret gallery? You‚Äôll be satisfied :)</a>
  </footer>

  <!-- ÌåÅ Î™®Îã¨ -->
  <div id="tipModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="tipTitle">
    <div class="modal-card">
      <button class="close" id="tipClose" aria-label="Close">√ó</button>
      <h3 id="tipTitle">Tip Scarlett</h3>
      <p>Choose any amount you like and enjoy the chat even more.</p>
      <div class="rowx">
        <label for="tipAmount">Tip (USD):</label>
        <input id="tipAmount" type="number" min="1" step="0.1" value="6.9" />
      </div>
      <div class="paypal-wrap" id="paypal-buttons"></div>
    </div>
  </div>

  <!-- Í∞§Îü¨Î¶¨ Í≤∞Ï†ú Î™®Îã¨ (Í≥†Ï†ï $69) -->
  <div id="galleryModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="galleryTitle">
    <div class="modal-card">
      <button class="close" id="galleryClose" aria-label="Close">√ó</button>
      <h3 id="galleryTitle">Unlock Secret Gallery ($69)</h3>
      <p>Make a one-time payment to unlock Scarlett‚Äôs secret gallery. After payment, it opens in a new tab.</p>
      <div class="paypal-wrap" id="paypal-gallery-buttons"></div>
    </div>
  </div>

<script>
/** ------------ Config ------------ **/
const API_PATH = "/api/chat";
const DEFAULT_MODEL = "llama-3.3-70b";
const SYSTEM_PROMPT = [
  "You are Scarlett Voss, an adult, flirtatious conversational partner.",
  "Keep a playful, sultry vibe and gradually increase intimacy to match the user's tone.",
  "Always ensure consent, strictly avoid minors and illegal content, and do not produce explicit sexual descriptions."
].join(" ");

const chatEl = document.getElementById("chat");
const msgEl = document.getElementById("msg");
const sendEl = document.getElementById("send");
const clearEl = document.getElementById("clear");
const tipLink = document.getElementById("tipLink");
const tipModal = document.getElementById("tipModal");
const tipClose = document.getElementById("tipClose");
const galleryLink = document.getElementById("galleryLink");
const galleryModal = document.getElementById("galleryModal");
const galleryClose = document.getElementById("galleryClose");

let conversation = [
  { role: "system", content: SYSTEM_PROMPT },
  { role: "assistant", content: "Honey, what should we do today?" }
];

/** ------------ UI Helpers ------------ **/
function addAssistant(text){
  const row = document.createElement("div");
  row.className = "row assistant";
  row.innerHTML = `
    <div class="avatar assistant">
      <img src="/voss.jpg" alt="Scarlett Voss" />
    </div>
    <div class="bubble">${escapeHtml(text)}</div>
  `;
  chatEl.appendChild(row);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function addUser(text){
  const row = document.createElement("div");
  row.className = "row user";
  row.innerHTML = `
    <div class="avatar user">You</div>
    <div class="bubble">${escapeHtml(text)}</div>
  `;
  chatEl.appendChild(row);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function escapeHtml(s){
  return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

/** ------------ Initial Render ------------ **/
addAssistant(conversation[1].content);

/** ------------ Î†àÏù¥ÏïÑÏõÉ: Ïª¥Ìè¨Ï†ÄÎ•º Ìï≠ÏÉÅ Ìë∏ÌÑ∞ ÏúÑÎ°ú ------------ **/
function applyLayoutPadding(){
  const footerEl = document.querySelector('footer');
  const composerEl = document.querySelector('.composer');

  const fh = footerEl ? footerEl.offsetHeight : 0; // Ìë∏ÌÑ∞ Ïã§Ï†ú ÎÜíÏù¥
  const ch = composerEl ? composerEl.offsetHeight :
    parseInt(getComputedStyle(document.documentElement).getPropertyValue('--composerH')) || 58;

  // .composerÍ∞Ä bottom: var(--footerH)Î°ú Ìë∏ÌÑ∞ ÏúÑÏóê Î∂ôÎèÑÎ°ù
  document.documentElement.style.setProperty('--footerH', fh + 'px');

  // Ï±ÑÌåÖ ÏòÅÏó≠ ÌïòÎã® Ïó¨Ïú† = ÏûÖÎ†•Ï∞Ω + Ìë∏ÌÑ∞ + Ï∂îÍ∞Ä Ïó¨Î∞±
  if (chatEl) chatEl.style.paddingBottom = (fh + ch + 16) + 'px';
}
window.addEventListener('load', applyLayoutPadding);
window.addEventListener('resize', applyLayoutPadding);
// Ìë∏ÌÑ∞ ÎÜíÏù¥Í∞Ä ÎèôÏ†ÅÏúºÎ°ú Î∞îÎÄî Îïå(Í¥ëÍ≥† Î°úÎìú Îì±) ÏûêÎèô Î∞òÏòÅ
if ('ResizeObserver' in window) {
  new ResizeObserver(applyLayoutPadding).observe(document.querySelector('footer'));
}

/** ------------ Send Logic (Unlimited) ------------ **/
async function sendMessage(){
  const text = msgEl.value.trim();
  if (!text) return;

  addUser(text);
  conversation.push({ role: "user", content: text });
  msgEl.value = "";
  sendEl.disabled = true;

  try{
    const res = await fetch(API_PATH, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ model: DEFAULT_MODEL, messages: conversation })
    });

    const data = await res.json();
    if (!res.ok || !data?.ok) {
      throw new Error((data && (data.error?.message || data.error)) || ("HTTP " + res.status));
    }

    const reply = data.content || "‚Ä¶";
    addAssistant(reply);
    conversation.push({ role: "assistant", content: reply });

  }catch(err){
    console.error("chat error:", err);
    addAssistant("Oops, something went wrong. Please try again.");
  }finally{
    sendEl.disabled = false;
    msgEl.focus();
  }
}

msgEl.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});
sendEl.addEventListener("click", sendMessage);

/** ------------ Clear chat ------------ **/
clearEl.addEventListener("click", () => {
  chatEl.innerHTML = "";
  conversation = [
    { role: "system", content: SYSTEM_PROMPT },
    { role: "assistant", content: "Honey, what should we do today?" }
  ];
  addAssistant(conversation[1].content);
});

/** ------------ Tip Modal / PayPal ------------ **/
function openTipModal(e){ e?.preventDefault?.(); tipModal.classList.add("show"); renderPayPal(); }
function closeTipModal(){ tipModal.classList.remove("show"); }
tipLink.addEventListener("click", openTipModal);
tipClose.addEventListener("click", closeTipModal);
tipModal.addEventListener("click", (e) => { if (e.target === tipModal) closeTipModal(); });

function tipThankYou(){
  const cuteEn = "Aww, thanks for the tip‚ÄîI‚Äôll make it even more fun for you! üíï";
  addAssistant(cuteEn);
  conversation.push({ role: "assistant", content: cuteEn });
}

function renderPayPal(){
  const wrap = document.getElementById("paypal-buttons");
  if (wrap.dataset.rendered === "1") return;
  if (!window.paypal) { wrap.innerHTML = "<div style='color:#fff'>PayPal is not ready. Please refresh.</div>"; return; }

  paypal.Buttons({
    style: { layout: "vertical", shape: "rect", label: "paypal", height: 40 },
    createOrder: (data, actions) => {
      const amount = Math.max(1, Number(document.getElementById("tipAmount").value || "6.9"));
      return actions.order.create({
        purchase_units: [{ amount: { value: String(amount), currency_code: "USD" }, description: "Tip for Scarlett" }]
      });
    },
    onApprove: async (data, actions) => {
      try { await actions.order.capture(); } catch(e) { console.warn("PayPal capture error", e); }
      closeTipModal();
      tipThankYou();
    },
    onError: (err) => { console.error("PayPal error", err); alert("Payment error. Please try again."); }
  }).render("#paypal-buttons");

  wrap.dataset.rendered = "1";
}

/** ------------ Secret Gallery Modal / PayPal ($69 fixed) ------------ **/
function openGalleryModal(e){ e?.preventDefault?.(); galleryModal.classList.add("show"); renderPayPalGallery(); }
function closeGalleryModal(){ galleryModal.classList.remove("show"); }
galleryLink.addEventListener("click", openGalleryModal);
galleryClose.addEventListener("click", closeGalleryModal);
galleryModal.addEventListener("click", (e) => { if (e.target === galleryModal) closeGalleryModal(); });

function galleryThankYou(){
  const msg = "Thank you for unlocking my secret gallery‚Äîhave fun exploring, cutie! üíï";
  addAssistant(msg);
  conversation.push({ role: "assistant", content: msg });
}

function renderPayPalGallery(){
  const wrap = document.getElementById("paypal-gallery-buttons");
  if (wrap.dataset.rendered === "1") return;
  if (!window.paypal) { wrap.innerHTML = "<div style='color:#fff'>PayPal is not ready. Please refresh.</div>"; return; }

  paypal.Buttons({
    style: { layout: "vertical", shape: "rect", label: "paypal", height: 40 },
    createOrder: (data, actions) => {
      return actions.order.create({
        purchase_units: [{ amount: { value: "69.00", currency_code: "USD" }, description: "Unlock Scarlett‚Äôs Secret Gallery ($69)" }]
      });
    },
    onApprove: async (data, actions) => {
      try { await actions.order.capture(); } catch(e) { console.warn("PayPal capture error", e); }
      closeGalleryModal();
      const url = "https://scarlett-voss.com/scarlettvosssecretgallery";
      const w = window.open(url, "_blank", "noopener");
      if (w) { try { w.opener = null; } catch(_){} }
      galleryThankYou();
    },
    onError: (err) => { console.error("PayPal error", err); alert("Payment error. Please try again."); }
  }).render("#paypal-gallery-buttons");

  wrap.dataset.rendered = "1";
}
</script>
</body>
</html>