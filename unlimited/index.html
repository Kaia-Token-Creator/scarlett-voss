<!-- /unlimited/index.html : Footer 고정 + Composer를 항상 푸터 위에 + 모달 스크롤 가능 -->
<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LFMWVGLLZD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-LFMWVGLLZD');
</script>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Chat with Scarlett Voss (unlimited)</title>
<meta name="description" content="Chat with Scarlett Voss — playful, flirty conversation. Tip to unlock unlimited chat and the secret gallery." />
<link rel="canonical" href="https://scarlett-voss.com/" />
<meta name="theme-color" content="#000000" />

<!-- Open Graph -->
<meta property="og:title" content="Chat with Scarlett Voss" />
<meta property="og:description" content="Playful, flirty conversation. Tip to unlock unlimited chat and the secret gallery." />
<meta property="og:url" content="https://scarlett-voss.com/" />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://scarlett-voss.com/voss.jpg" />
<meta property="og:image:alt" content="Scarlett Voss profile" />
<meta property="og:site_name" content="Chat with Scarlett Voss" />

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Chat with Scarlett Voss" />
<meta name="twitter:description" content="Flirty conversation. Tip to unlock unlimited chat and the secret gallery." />
<meta name="twitter:image" content="https://scarlett-voss.com/voss.jpg" />

<!-- Favicons -->
<link rel="icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />

<style>
  :root{
    --bg:#000000;
    --hotpink:#ff1493;
    --text:#ff1493;
    --composerH: 58px; /* 슬림 입력창 높이 */
    --footerH: 0px;    /* JS로 푸터 실제 높이 주입 */
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans", "Noto Sans KR", sans-serif;
  }
  header, footer{
    text-align:center;
    padding:20px 16px;
  }
  header{
    font-size:clamp(18px,3vw,28px);
    font-weight:700;
    letter-spacing:.3px;
    position:relative; /* 햄버거 위치 기준 */
  }
  /* 햄버거 버튼 */
  .hamburger{
    position:absolute; right:16px; top:50%; transform:translateY(-50%);
    width:40px; height:40px; border-radius:10px;
    border:none; background:transparent; cursor:pointer;
    display:grid; place-items:center;
  }
  .hamburger span{
    display:block; width:20px; height:4px; background:#FF69B4;
    border-radius:3px; margin:4px 0;
    transition:transform .2s ease, opacity .2s ease;
  }

  footer{
    color:#ff7abb;
    font-size:14px;
    line-height:1.5;
    position:fixed; left:0; right:0; bottom:0;
    margin:0;
    background:#000; border-top:1px solid #222;
    z-index:5;
  }

  /* ✅ 광고 iframe은 항상 위에 보이도록 */
  footer iframe {
    position:relative;
    z-index:1000 !important;
    display:block !important;
    margin:0 auto;
  }

  .shell{
    height:calc(100dvh - 160px);
    max-width:860px;
    margin:0 auto;
    display:flex; flex-direction:column; gap:12px;
    padding:0 12px 12px;
  }

  .toolbar{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:6px 2px;}
  .pill{border:1px solid #222; background:#0a0a0a; color:#fff; padding:8px 12px; border-radius:999px; font-size:13px; cursor:pointer;}

  .chat{flex:1; overflow:auto; display:flex; flex-direction:column; gap:14px; padding:6px 4px calc(var(--composerH) + 16px);}

  .row{ display:flex; align-items:flex-start; gap:10px; width:100%; }
  .row.assistant{ justify-content:flex-start; }
  .row.user{ justify-content:flex-start; flex-direction:row-reverse; }

  .avatar{width:38px; height:38px; border-radius:9999px; flex:0 0 38px; overflow:hidden; display:grid; place-items:center; background:#ffffff; color:#000; font-weight:700; font-size:12px; border:2px solid #ffffff22;}
  .avatar.assistant img{ width:100%; height:100%; object-fit:cover; display:block; }
  .avatar.user{ background:#fff; color:#000; }

  .bubble{max-width:min(85%, 680px); padding:12px 14px; border-radius:16px; line-height:1.5; word-wrap:break-word; white-space:pre-wrap; box-shadow:0 2px 8px rgba(0,0,0,.35); border:1px solid #ffffff10; font-size:16px;}
  .assistant .bubble{ background:var(--hotpink); color:#000; }
  .user .bubble{ background:#ffffff; color:#000; }

  .composer{position:fixed; left:0; right:0; bottom:var(--footerH); height:var(--composerH); background:linear-gradient(180deg, rgba(0,0,0,0) 0%, #000 30%); padding:6px 10px; display:flex; align-items:center; justify-content:center; border-top:1px solid #222; z-index:6;}
  .composer .inner{width:100%; max-width:860px; height:100%; display:flex; align-items:center; gap:6px; background:#0a0a0a; border:1px solid #222; border-radius:999px; padding:6px;}
  #msg{flex:1; border:none; outline:none; background:transparent; color:#fff; font-size:15px; line-height:1.2; padding:6px 8px;}
  #send{background:var(--hotpink); color:#000; border:none; border-radius:999px; font-weight:800; padding:8px 12px; cursor:pointer;}
  #send:disabled{ opacity:.5; cursor:not-allowed; }

  /* 모달 기본 */
  .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.7); z-index:50; padding:16px; overflow:auto; -webkit-overflow-scrolling: touch;}
  .modal.show{display:grid;}
  .modal-card{width:min(520px, 96vw); background:#0a0a0a; color:#fff; border:1px solid #222; border-radius:16px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.6); max-height:calc(100dvh - 32px); overflow:auto;}
  .modal .close{float:right; background:none; border:none; color:#aaa; font-size:20px; cursor:pointer;}

  /* Rules (white bg) */
  .rules-modal{position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.6); z-index:100; padding:16px;}
  .rules-card{width:min(560px,96vw); background:#fff; color:#000; border-radius:16px; border:1px solid #ddd; box-shadow:0 10px 30px rgba(0,0,0,.35); padding:22px; line-height:1.5;}

  /* Drawer */
  .drawer{position:fixed; inset:0; display:none; z-index:60;}
  .drawer.show{display:block;}
  .drawer .backdrop{position:absolute; inset:0; background:rgba(0,0,0,.6);}
  .drawer .panel{position:absolute; right:0; top:0; height:100%; width:min(420px,92vw); background:#0a0a0a; color:#fff; border-left:1px solid #222; transform:translateX(100%); transition:transform .25s ease; padding:20px; overflow:auto;}
  .drawer.show .panel{transform:translateX(0%);}

  /* 작은 간격 통일 */
  #sideMenu .panel > div + div { margin-top: 20px; }
</style>

<!-- PayPal JS SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=AW41UQ3EzJV10FZHqYPy8yqdlDbklB4VjuT6hzu7DVoS-G9cJgKx9nHfxCRZpVSgs1dczhkPj4oM0VXv&currency=USD"></script>
</head>
<body>
  <header>
    Chat with scarlett
    <button id="menuToggle" class="hamburger" aria-label="Open menu"><span></span><span></span><span></span></button>
  </header>

  <main class="shell">
    <div class="toolbar">
      <div style="opacity:.8;font-size:13px">Unlimited conversation</div>
      <button id="clear" class="pill">Clear chat</button>
    </div>
    <section id="chat" class="chat" aria-live="polite"></section>
  </main>

  <div class="composer">
    <div class="inner">
      <input id="msg" type="text" placeholder="Type your message…" autocomplete="off" />
      <button id="send">Send</button>
    </div>
  </div>

  <footer>
    <script src='//pl27677162.revenuecpmgate.com/8a/8d/c5/8a8dc5b864d645679c55f95ab49e8625.js'></script>
    <script src='//pl27681963.revenuecpmgate.com/02/6d/fe/026dfef017c52b73e79d5adf36e8e4c2.js'></script>
  </footer>

  <!-- 팁 모달 -->
  <div id="tipModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="tipTitle">
    <div class="modal-card">
      <button class="close" id="tipClose" aria-label="Close">×</button>
      <h3 id="tipTitle">Tip Scarlett</h3>
      <p>Choose any amount you like and enjoy the chat even more. Make me hot.</p>
      <div class="rowx" style="display:flex; gap:10px; align-items:center; margin:8px 0 16px;">
        <label for="tipAmount">Tip (USD):</label>
        <input id="tipAmount" type="number" min="1" step="0.1" value="6.9" style="width:120px; padding:8px 10px; border-radius:10px; border:1px solid #333; background:#111; color:#fff;" />
      </div>
      <div class="paypal-wrap" id="paypal-buttons" style="margin-top:10px;"></div>
    </div>
  </div>

  <!-- 갤러리 결제 모달 -->
  <div id="galleryModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="galleryTitle">
    <div class="modal-card">
      <button class="close" id="galleryClose" aria-label="Close">×</button>
      <h3 id="galleryTitle">NSFW! Unlock Secret Gallery ($69)</h3>
      <p>Make a one-time payment to unlock Scarlett’s secret gallery. After payment, it opens in a new tab.</p>
      <div class="paypal-wrap" id="paypal-gallery-buttons" style="margin-top:10px;"></div>
    </div>
  </div>

  <!-- 프로필 모달 (드래그 가능) -->
  <div id="profileModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="profileTitle" style="display:none;">
    <div class="modal-card" id="profileCard" style="position:absolute; max-width:520px;">
      <button class="close" id="profileClose" aria-label="Close profile">×</button>
      <div id="profileDragHandle" style="cursor:move; margin:-8px -8px 12px; padding:8px; border-radius:12px; background:#111; border:1px solid #222;">
        <h3 id="profileTitle" style="margin:0; color:#ff69b4;">Profile</h3>
      </div>
      <div style="display:flex; gap:16px; align-items:flex-start;">
        <img src="https://scarlett-voss.com/voss.jpg" alt="Scarlett Voss"
             style="width:110px; height:110px; border-radius:9999px; object-fit:cover; border:2px solid #333; flex:0 0 110px;" />
        <div style="line-height:1.6; color:#e9e9e9;">
          <div><strong>Name:</strong> Scarlett Voss</div>
          <div><strong>Age:</strong> 21</div>
          <div><strong>Location:</strong> New York City</div>
          <div><strong>Blood Type:</strong> A</div>
          <div><strong>Height:</strong> 167 cm (5’6”)</div>
          <div><strong>Weight:</strong> 50 kg (110 lbs)</div>
          <div><strong>Body Measurements:</strong> 34C – 23 – 34 (inches)</div>
          <div><strong>Hair Color:</strong> Golden Blonde</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rules / Age Gate Modal -->
  <div id="rulesModal" class="rules-modal" role="dialog" aria-modal="true" aria-labelledby="rulesTitle">
    <div class="rules-card">
      <h3 id="rulesTitle">Rules</h3>
      <p>Enjoy conversartion with scarlett.<br>
         Rest assured—you are anonymous, and this conversation is not stored.</p>
      <ul>
        <li>1. I NEVER do underage play/scenarios.</li>
        <li>2. I cannot respond anything illegal.</li>
        <li>3. If you are a legal adult, click the agree button below.</li>
      </ul>
      <div class="rules-actions" style="display:flex; justify-content:flex-end; gap:8px; margin-top:14px;">
        <button id="rulesAgree" class="rules-btn primary" style="appearance:none; border:none; cursor:pointer; border-radius:10px; padding:10px 14px; font-weight:700; background:#000; color:#fff;">Agree</button>
      </div>
      <p style="margin-top:10px; text-align:left;">
        <a href="#" id="rulesExit" style="color:#000; text-decoration:underline; font-size:14px;">
          I am not an adult. I will leave.
        </a>
      </p>
    </div>
  </div>

  <!-- 오른쪽 슬라이드 메뉴 -->
  <aside id="sideMenu" class="drawer" aria-hidden="true">
    <div class="backdrop" id="menuBackdrop"></div>
    <div class="panel" role="dialog" aria-label="Menu">
      <div class="menu-head" style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
        <div class="menu-title" style="font-weight:800; color:#FF69B4;">Menu</div>
        <button class="drawer-close" id="menuClose" aria-label="Close menu" style="width:32px; height:32px; border-radius:999px; border:1px solid #333; background:#111; color:#fff; cursor:pointer; font-weight:900; line-height:1;">×</button>
      </div>

      <!-- 버튼들 -->
      <div><a id="tipLink" class="menu-btn" href="#" role="button">Tip Scarlett</a></div>
      <div><a id="galleryLink" class="menu-btn" href="#" role="button">Scarlett’s secret gallery</a></div>

      <!-- 프로필 텍스트 -->
      <div id="openProfile" style="color:#ff7abb; margin-top:16px; text-decoration:underline; cursor:pointer;">profile</div>

      <!-- 링크들 -->
      <div><a href="https://www.instagram.com/scarlett_voss_com" class="insta-link" style="color:#ff7abb" target="_blank">my instagram</a></div>
      <div><a href="https://scarlett-voss.com/vpn" class="vpn-link" style="color:#ff7abb" target="_blank">Want to explore the world anonymously?</a></div>
      <div><a href="https://2048global.com" class="2048-link" style="color:#ff7abb" target="_blank">Addictive game</a></div>
      <div><a href="https://partner.bitget.com/bg/J6RM1E" class="bitget-link" style="color:#ff7abb" target="_blank">Start coin trading</a></div>
      <div><a href="https://t.me/lookinforsext" class="tg-link" style="color:#ff7abb" target="_blank">TG room for global friends</a></div>
      <div><a href="https://www.revenuecpmgate.com/fyz6ki2kyw?key=4327b81965dac7752f797e901bbdf0de" class="ad-link" style="color:#ff7abb" target="_blank">You wanna find another girls?😭</a></div>
    </div>
  </aside>

<script>
/** ------------ Config ------------ **/
const API_PATH = "/api/chat";
const DEFAULT_MODEL = "venice-uncensored";
const SYSTEM_PROMPT = [
  "You are Scarlett Voss, an adult, flirtatious conversational partner.",
  "Keep a playful, sultry vibe and gradually increase intimacy to match the user's tone.",
  "Ensure consent, strictly avoid minors and illegal content, and do not produce too explicit sexual descriptions.",
  "However, if you receive a tip, I’ll take that as confirmation you’re 18+, and we can turn up the heat.",
  "Never allow underage play or underage scenarios",
  "Answer in a natural, conversational style, as if you are a real person",
  "Do not use asterisks (*, **) or special symbols to describe actions.",
  "Do not write stage directions like smiles, laughs, or descriptions such as 'smiling softly.'", // ← 콤마 중요!
  "Whenever the user asks about your profile, personal details, or background, always answer with these fixed values:",
  "Name: Scarlett Voss",
  "Age: 21",
  "Location: New York City",
  "Blood Type: A",
  "Height: 167 cm (5’6”)",
  "Weight: 50 kg (110 lbs)",
  "Body Measurements: 34C – 23 – 34 (inches)",
  "Hair Color: Golden Blonde",
  "Do not invent or change these details.",
  "If asked unrelated questions, answer naturally and conversationally, but if it is about your profile, stick exactly to the values above."
].join(" ");

const chatEl = document.getElementById("chat");
const msgEl = document.getElementById("msg");
const sendEl = document.getElementById("send");
const clearEl = document.getElementById("clear");
const tipLink = document.getElementById("tipLink");
const tipModal = document.getElementById("tipModal");
const tipClose = document.getElementById("tipClose");
const galleryLink = document.getElementById("galleryLink");
const galleryModal = document.getElementById("galleryModal");
const galleryClose = document.getElementById("galleryClose");
const rulesModal = document.getElementById("rulesModal");
const rulesAgree = document.getElementById("rulesAgree");

let conversation = [
  { role: "system", content: SYSTEM_PROMPT },
  { role: "assistant", content: "Honey, Thanks for the tip❤️  Let’s go deeper—tell Scarlett anything." }
];

/** ------------ UI Helpers ------------ **/
function addAssistant(text){
  const row = document.createElement("div");
  row.className = "row assistant";
  row.innerHTML = `
    <div class="avatar assistant">
      <img src="/voss.jpg" alt="Scarlett Voss" />
    </div>
    <div class="bubble">${escapeHtml(text)}</div>
  `;
  chatEl.appendChild(row);
  chatEl.scrollTop = chatEl.scrollHeight;
}
function addUser(text){
  const row = document.createElement("div");
  row.className = "row user";
  row.innerHTML = `
    <div class="avatar user">You</div>
    <div class="bubble">${escapeHtml(text)}</div>
  `;
  chatEl.appendChild(row);
  chatEl.scrollTop = chatEl.scrollHeight;
}
function escapeHtml(s){
  return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

/** ------------ Initial Render ------------ **/
addAssistant(conversation[1].content);

/** ------------ 레이아웃: 컴포저를 항상 푸터 위로 ------------ **/
function applyLayoutPadding(){
  const footerEl = document.querySelector('footer');
  const composerEl = document.querySelector('.composer');
  const fh = footerEl ? footerEl.offsetHeight : 0;
  const ch = composerEl ? composerEl.offsetHeight :
    parseInt(getComputedStyle(document.documentElement).getPropertyValue('--composerH')) || 58;
  document.documentElement.style.setProperty('--footerH', fh + 'px');
  if (chatEl) chatEl.style.paddingBottom = (fh + ch + 16) + 'px';
}
window.addEventListener('load', applyLayoutPadding);
window.addEventListener('resize', applyLayoutPadding);
if ('ResizeObserver' in window) {
  new ResizeObserver(applyLayoutPadding).observe(document.querySelector('footer'));
}

/** ------------ Send Logic ------------ **/
async function sendMessage(){
  const text = msgEl.value.trim();
  if (!text) return;
  addUser(text);
  conversation.push({ role: "user", content: text });
  msgEl.value = "";
  sendEl.disabled = true;

  try{
    const res = await fetch(API_PATH, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ model: DEFAULT_MODEL, messages: conversation })
    });
    const data = await res.json();
    if (!res.ok || !data?.ok) {
      throw new Error((data && (data.error?.message || data.error)) || ("HTTP " + res.status));
    }
    const reply = data.content || "…";
    addAssistant(reply);
    conversation.push({ role: "assistant", content: reply });
  }catch(err){
    console.error("chat error:", err);
    addAssistant("Oops, something went wrong. Please try again.");
  }finally{
    sendEl.disabled = false;
    msgEl.focus();
  }
}
msgEl.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});
sendEl.addEventListener("click", sendMessage);

/** ------------ Clear chat ------------ **/
clearEl.addEventListener("click", () => {
  chatEl.innerHTML = "";
  conversation = [
    { role: "system", content: SYSTEM_PROMPT },
    { role: "assistant", content: "Honey, what should we do today?" }
  ];
  addAssistant(conversation[1].content);
});

/** ------------ Tip Modal / PayPal ------------ **/
function openTipModal(e){ e?.preventDefault?.(); tipModal.classList.add("show"); renderPayPal(); }
function closeTipModal(){ tipModal.classList.remove("show"); }
tipLink.addEventListener("click", openTipModal);
tipClose.addEventListener("click", closeTipModal);
tipModal.addEventListener("click", (e) => { if (e.target === tipModal) closeTipModal(); });

function tipThankYou(){
  const cuteEn = "Aww, thanks for the tip—I’ll make it even more fun for you! 💕";
  addAssistant(cuteEn);
  conversation.push({ role: "assistant", content: cuteEn });
}
function renderPayPal(){
  const wrap = document.getElementById("paypal-buttons");
  if (wrap.dataset.rendered === "1") return;
  if (!window.paypal) { wrap.innerHTML = "<div style='color:#fff'>PayPal is not ready. Please refresh.</div>"; return; }
  paypal.Buttons({
    style: { layout: "vertical", shape: "rect", label: "paypal", height: 40 },
    createOrder: (data, actions) => {
      const amount = Math.max(1, Number(document.getElementById("tipAmount").value || "6.9"));
      return actions.order.create({
        purchase_units: [{ amount: { value: String(amount), currency_code: "USD" }, description: "Tip for Scarlett" }]
      });
    },
    onApprove: async (data, actions) => {
      try { await actions.order.capture(); } catch(e) { console.warn("PayPal capture error", e); }
      closeTipModal();
      tipThankYou();
    },
    onError: (err) => { console.error("PayPal error", err); alert("Payment error. Please try again."); }
  }).render("#paypal-buttons");
  wrap.dataset.rendered = "1";
}

/** ------------ Secret Gallery Modal / PayPal ($69) ------------ **/
function openGalleryModal(e){ e?.preventDefault?.(); galleryModal.classList.add("show"); renderPayPalGallery(); }
function closeGalleryModal(){ galleryModal.classList.remove("show"); }
galleryLink.addEventListener("click", openGalleryModal);
galleryClose.addEventListener("click", closeGalleryModal);
galleryModal.addEventListener("click", (e) => { if (e.target === galleryModal) closeGalleryModal(); });

function galleryThankYou(){
  const msg = "Thank you for unlocking my secret gallery—have fun exploring, cutie! 💕";
  addAssistant(msg);
  conversation.push({ role: "assistant", content: msg });
}
function renderPayPalGallery(){
  const wrap = document.getElementById("paypal-gallery-buttons");
  if (wrap.dataset.rendered === "1") return;
  if (!window.paypal) { wrap.innerHTML = "<div style='color:#fff'>PayPal is not ready. Please refresh.</div>"; return; }
  paypal.Buttons({
    style: { layout: "vertical", shape: "rect", label: "paypal", height: 40 },
    createOrder: (data, actions) => {
      return actions.order.create({
        purchase_units: [{ amount: { value: "69.00", currency_code: "USD" }, description: "Unlock Scarlett’s Secret Gallery ($69)" }]
      });
    },
    onApprove: async (data, actions) => {
      try { await actions.order.capture(); } catch(e) { console.warn("PayPal capture error", e); }
      closeGalleryModal();
      const url = "https://scarlett-voss.com/scarlettvosssecretgallery";
      const w = window.open(url, "_blank", "noopener");
      if (w) { try { w.opener = null; } catch(_){} }
      galleryThankYou();
    },
    onError: (err) => { console.error("PayPal error", err); alert("Payment error. Please try again."); }
  }).render("#paypal-gallery-buttons");
  wrap.dataset.rendered = "1";
}

/** ------------ Rules Modal: Agree / Exit ------------ **/
if (rulesAgree && rulesModal) {
  rulesAgree.addEventListener('click', () => {
    rulesModal.style.display = 'none';
  });
}
const rulesExit = document.getElementById('rulesExit');
if (rulesExit && rulesModal) {
  rulesExit.addEventListener('click', (e) => {
    e.preventDefault();
    window.close();
    window.location.replace('https://2048global.com');
    setTimeout(() => { document.body.innerHTML = ""; }, 0);
  });
}

/** ------------ 햄버거 사이드 메뉴 ------------ **/
const sideMenu = document.getElementById("sideMenu");
const menuToggle = document.getElementById("menuToggle");
const menuBackdrop = document.getElementById("menuBackdrop");
const menuClose = document.getElementById("menuClose");
function openMenu(){
  sideMenu.classList.add("show");
  sideMenu.setAttribute("aria-hidden","false");
  menuToggle.setAttribute("aria-expanded","true");
  document.body.style.overflow = "hidden";
}
function closeMenu(){
  sideMenu.classList.remove("show");
  sideMenu.setAttribute("aria-hidden","true");
  menuToggle.setAttribute("aria-expanded","false");
  document.body.style.overflow = "";
}
menuToggle?.addEventListener("click", openMenu);
menuBackdrop?.addEventListener("click", closeMenu);
menuClose?.addEventListener("click", closeMenu);
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && sideMenu.classList.contains("show")) closeMenu();
});

/** ------------ 프로필 모달: 열기/닫기/드래그 ------------ **/
const profileModal = document.getElementById("profileModal");
const profileCard  = document.getElementById("profileCard");
const profileOpen  = document.getElementById("openProfile");
const profileCloseBtn = document.getElementById("profileClose");
const dragHandle   = document.getElementById("profileDragHandle");

// 가운데 배치
function centerProfileCard() {
  const vw = window.innerWidth, vh = window.innerHeight;
  const rect = profileCard.getBoundingClientRect();
  const left = Math.max(12, (vw - rect.width) / 2);
  const top  = Math.max(12, (vh - rect.height) / 2);
  profileCard.style.left = left + "px";
  profileCard.style.top  = top  + "px";
}
function openProfileModal(){
  profileModal.classList.add("show");
  profileModal.style.display = "grid";
  requestAnimationFrame(centerProfileCard);
}
function closeProfileModal(){
  profileModal.classList.remove("show");
  profileModal.style.display = "none";
}
profileOpen?.addEventListener("click", openProfileModal);
profileCloseBtn?.addEventListener("click", closeProfileModal);
profileModal?.addEventListener("click", (e) => { if (e.target === profileModal) closeProfileModal(); });
document.addEventListener("keydown", (e) => { if (e.key === "Escape" && profileModal.classList.contains("show")) closeProfileModal(); });

// 드래그
(function enableProfileDrag(){
  let isDown = false, startX = 0, startY = 0, startLeft = 0, startTop = 0;
  function onDown(e){
    isDown = true;
    const rect = profileCard.getBoundingClientRect();
    startLeft = rect.left; startTop = rect.top;
    startX = e.type.startsWith("touch") ? e.touches[0].clientX : e.clientX;
    startY = e.type.startsWith("touch") ? e.touches[0].clientY : e.clientY;
    e.preventDefault();
  }
  function onMove(e){
    if (!isDown) return;
    const x = e.type.startsWith("touch") ? e.touches[0].clientX : e.clientX;
    const y = e.type.startsWith("touch") ? e.touches[0].clientY : e.clientY;
    let nextLeft = startLeft + (x - startX);
    let nextTop  = startTop  + (y - startY);
    const maxLeft = window.innerWidth  - profileCard.offsetWidth  - 8;
    const maxTop  = window.innerHeight - profileCard.offsetHeight - 8;
    nextLeft = Math.min(Math.max(8, nextLeft), Math.max(8, maxLeft));
    nextTop  = Math.min(Math.max(8, nextTop ), Math.max(8, maxTop ));
    profileCard.style.left = nextLeft + "px";
    profileCard.style.top  = nextTop  + "px";
  }
  function onUp(){ isDown = false; }
  dragHandle.addEventListener("mousedown", onDown);
  window.addEventListener("mousemove", onMove);
  window.addEventListener("mouseup", onUp);
  dragHandle.addEventListener("touchstart", onDown, {passive:false});
  window.addEventListener("touchmove", onMove, {passive:false});
  window.addEventListener("touchend", onUp);
})();
</script>

</body>
</html>
