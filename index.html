<!-- /demo/index.html (ÏûÖÎ†•Ï∞ΩÏùÄ Ìï≠ÏÉÅ Ìë∏ÌÑ∞ ÏúÑ, Î™®Îã¨ ÌôîÎ©¥ Ï¥àÍ≥º Ïãú Ïä§ÌÅ¨Î°§ Í∞ÄÎä•) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LFMWVGLLZD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-LFMWVGLLZD');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Chat with Scarlett Voss</title>
  <meta name="description" content="Chat with Scarlett Voss ‚Äî playful, flirty conversation. Tip to unlock unlimited chat and the secret gallery." />
  <link rel="canonical" href="https://scarlett-voss.com/" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />

  <!-- Open Graph -->
  <meta property="og:title" content="Chat with Scarlett Voss" />
  <meta property="og:description" content="Playful, flirty conversation. Tip to unlock unlimited chat and the secret gallery." />
  <meta property="og:url" content="https://scarlett-voss.com/" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://scarlett-voss.com/voss.jpg" />
  <meta property="og:image:alt" content="Scarlett Voss profile" />
  <meta property="og:site_name" content="Chat with Scarlett Voss" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Chat with Scarlett Voss" />
  <meta name="twitter:description" content="Flirty conversation. Tip to unlock unlimited chat and the secret gallery." />
  <meta name="twitter:image" content="https://scarlett-voss.com/voss.jpg" />

  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />

  <style>
    :root{
      --bg:#000000;
      --hotpink:#ff1493;
      --text:#ff1493;
      /* ‚ñº ÏûÖÎ†•Ï∞Ω(Ïª¥Ìè¨Ï†Ä) Í≥†Ï†ï ÎÜíÏù¥ */
      --composerH: 58px;
      /* ‚ñº JSÍ∞Ä Ìë∏ÌÑ∞ Ïã§Ï†ú ÎÜíÏù¥Î°ú ÏóÖÎç∞Ïù¥Ìä∏ */
      --footerH: 0px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans", "Noto Sans KR", sans-serif;
      padding-bottom: calc(var(--composerH) + 12px);
    }
    header, footer{
      text-align:center;
      padding:20px 16px;
    }
    header{
      font-size:clamp(18px,3vw,28px);
      font-weight:700;
      letter-spacing:.3px;
      position:relative; /* ÌñÑÎ≤ÑÍ±∞ Ï†àÎåÄÏúÑÏπò Í∏∞Ï§Ä */
    }
  /* ÌñÑÎ≤ÑÍ±∞ Î≤ÑÌäº (Ìï´ÌïëÌÅ¨) */
.hamburger{
  position:absolute; right:16px; top:50%; transform:translateY(-50%);
  width:40px; height:40px; border-radius:10px;
  /* border:2px solid #FF69B4;  ‚Üê Ïù¥ Ï§Ñ ÏßÄÏö∞Í±∞ÎÇò Ï£ºÏÑù Ï≤òÎ¶¨ */
  border:none;                  /* ‚Üê ÌÖåÎëêÎ¶¨ Ï†úÍ±∞ */
  background:transparent;
  cursor:pointer;
  display:grid; place-items:center;
}

    .hamburger span{
  display:block;
  width:20px;       /* Í∏∞Ï°¥ 18px ‚Üí ÏïΩÍ∞Ñ Îçî Í∏∏Í≤å */
  height:4px;       /* Í∏∞Ï°¥ 2px ‚Üí 4pxÎ°ú ÍµµÍ≤å */
  background:#FF69B4;
  border-radius:3px;/* Î™®ÏÑúÎ¶¨ ÏÇ¥Ïßù Îë•Í∏ÄÍ≤å(ÏÑ†ÌÉù) */
  margin:4px 0;     /* Í∞ÑÍ≤© ÏÇ¥Ïßù ÎÑìÌûò */
  transition:transform .2s ease, opacity .2s ease;
}
    .hamburger:focus-visible{ outline:3px solid #ff6ec7; outline-offset:2px; }

    footer{
      color:#ff7abb;
      font-size:14px;
      line-height:1.5;
      /* ‚ñº Ìï≠ÏÉÅ ÌôîÎ©¥ Îß® ÏïÑÎûò Í≥†Ï†ï + Î∞∞Í≤Ω/Í≤ΩÍ≥ÑÏÑ† */
      position:fixed; left:0; right:0; bottom:0;
      background:#000; border-top:1px solid #222;
      z-index:5;
    }

    /* (Î©îÎâ¥Î°ú Ïù¥ÎèôÌñàÏúºÎØÄÎ°ú Ìë∏ÌÑ∞ ÏΩòÌÖêÏ∏†Îäî ÎπÑÏõÄ) */
    .footer-cta{
      display:flex; justify-content:center; align-items:center;
      gap:10px; margin-bottom:10px; flex-wrap:wrap;
    }
    .footer-cta button{
      appearance:none; border:none; cursor:pointer;
      background:#FF69B4; color:#000; font-weight:900;
      padding:10px 14px; border-radius:999px; font-size:14px;
      min-width:160px;
      box-shadow: 0 0 18px rgba(255,105,180,.45), 0 6px 20px rgba(0,0,0,.35);
      transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
      animation: spicyPulse 1.6s ease-in-out infinite;
      position: relative;
    }
    .footer-cta button:active{ transform: translateY(1px); }
    .footer-cta button:hover{ transform: translateY(-1px) scale(1.02); }
    .footer-cta button:focus-visible{
      outline: 3px solid #ff6ec7; outline-offset: 2px; filter: brightness(1.05);
    }

    .shell{
      height:calc(100dvh - 160px);
      max-width:860px;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:12px;
      padding:0 12px 12px;
    }

    .chat{
      flex:1; overflow:auto;
      display:flex; flex-direction:column; gap:14px;
      /* ‚ñº ÌïòÎã® Ïó¨Ïú†Îäî JSÍ∞Ä ÎçÆÏñ¥ÏîÄ(Ï¥àÍ∏∞Í∞íÎßå) */
      padding:6px 4px calc(var(--composerH) + 16px);
    }

    .row{ display:flex; align-items:flex-start; gap:10px; width:100%; }
    .row.assistant{ justify-content:flex-start; }
    .row.user{ justify-content:flex-start; flex-direction:row-reverse; }

    .avatar{
      width:38px; height:38px; border-radius:9999px; flex:0 0 38px; overflow:hidden;
      display:grid; place-items:center; background:#ffffff; color:#000; font-weight:700; font-size:12px;
      border:2px solid #ffffff22;
    }
    .avatar.assistant img{ width:100%; height:100%; object-fit:cover; display:block; }
    .avatar.user{ background:#fff; color:#000; }

    .bubble{
      max-width:min(85%, 680px);
      padding:12px 14px; border-radius:16px; line-height:1.5; word-wrap:break-word; white-space:pre-wrap;
      box-shadow:0 2px 8px rgba(0,0,0,.35);
      border:1px solid #ffffff10;
      font-size:16px;
    }
    .assistant .bubble{ background:var(--hotpink); color:#000; }
    .user .bubble{ background:#ffffff; color:#000; }

    /* ‚ñº ÏûÖÎ†•Ï∞ΩÏùÑ Ïä¨Î¶º + Ìë∏ÌÑ∞ ÏúÑÎ°ú ÎùÑÏõÄ(Î≥ÄÏàòÎ°ú Ï†úÏñ¥) */
    .composer{
      position:fixed; left:0; right:0;
      bottom:var(--footerH);                 /* JSÍ∞Ä Ìë∏ÌÑ∞ ÎÜíÏù¥Î•º ÎÑ£Ïñ¥Ï§å */
      height:var(--composerH);               /* Í≥†Ï†ï ÎÜíÏù¥ */
      background:linear-gradient(180deg, rgba(0,0,0,0) 0%, #000 30%);
      padding:6px 10px;
      display:flex; align-items:center; justify-content:center;
      border-top:1px solid #222;
      z-index:6; /* Ìë∏ÌÑ∞Î≥¥Îã§ ÏúÑ */
    }
    .composer .inner{
      width:100%; max-width:860px; height:100%;
      display:flex; align-items:center; gap:6px;
      background:#0a0a0a; border:1px solid #222; border-radius:999px; padding:6px;
    }
    #msg{
      flex:1; border:none; outline:none; background:transparent; color:#fff;
      font-size:15px; line-height:1.2; padding:6px 8px;
    }
    #send{
      background:var(--hotpink); color:#000; border:none; border-radius:999px;
      font-weight:800; padding:8px 12px;
      cursor:pointer;
    }
    #send:disabled{ opacity:.5; cursor:not-allowed; }

    /* ===== PayPal Tip Modal ===== */
    .modal{
      position:fixed; inset:0; display:none; place-items:center;
      background:rgba(0,0,0,.7); z-index:50; padding:16px;
      overflow:auto;                         /* ‚Üê Î™®Îã¨ Ïò§Î≤ÑÎ†àÏù¥ ÏûêÏ≤¥ Ïä§ÌÅ¨Î°§ ÌóàÏö© */
      -webkit-overflow-scrolling: touch;     /* iOS Î∂ÄÎìúÎü¨Ïö¥ Ïä§ÌÅ¨Î°§ */
    }
    .modal.show{ display:grid; }
    .modal-card{
      position:relative;
      width:min(520px, 96vw); background:#0a0a0a; color:#fff; border:1px solid #222; border-radius:16px;
      padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.6);
      max-height: calc(100dvh - 32px);
      overflow:auto; -webkit-overflow-scrolling: touch; touch-action: pan-y; overscroll-behavior: contain;
    }
    .modal h3{ margin:0 0 8px; color:var(--hotpink) }
    .modal p{ margin:0 0 12px; color:#e9e9e9 }
    .modal .rowx{ display:flex; gap:10px; align-items:center; margin:8px 0 16px }
    .modal input{ width:120px; padding:8px 10px; border-radius:10px; border:1px solid #333; background:#111; color:#fff; }
    .paypal-wrap{ margin-top:10px }

    /* Î™®Îã¨ Îã´Í∏∞(X) */
    .modal-close{
      position:absolute; top:10px; right:10px;
      width:32px; height:32px; border-radius:999px; border:1px solid #333;
      background:#111; color:#fff; cursor:pointer;
      font-weight:900; line-height:1;
    }

    /* ÌñÑÎ≤ÑÍ±∞ ÏÇ¨Ïù¥Îìú Î©îÎâ¥ (Ïö∞ ‚Üí Ï¢å) */
    .drawer{
      position:fixed; inset:0; display:none; z-index:60;
    }
    .drawer.show{ display:block; }
    .drawer .backdrop{
      position:absolute; inset:0; background:rgba(0,0,0,.6);
    }
    .drawer .panel{
      position:absolute; right:0; top:0; height:100%;
      width:min(420px, 92vw); background:#0a0a0a; color:#fff; border-left:1px solid #222;
      transform:translateX(100%); transition:transform .25s ease;
      padding:20px; overflow:auto; -webkit-overflow-scrolling:touch;
    }
    .drawer.show .panel{ transform:translateX(0%); }
    .drawer .panel .menu-head{
      display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;
    }
    .drawer .panel .menu-title{ font-weight:800; color:#FF69B4; }
    .drawer-close{
      width:32px; height:32px; border-radius:999px; border:1px solid #333;
      background:#111; color:#fff; cursor:pointer; font-weight:900; line-height:1;
    }

    /* ÌéÑÏä§ */
    @keyframes spicyPulse{
      0%,100%{ box-shadow: 0 0 16px rgba(255,20,147,.4), 0 6px 20px rgba(0,0,0,.35); }
      50%{ box-shadow: 0 0 28px rgba(255,20,147,.75), 0 10px 26px rgba(0,0,0,.45); }
    }
 #sideMenu .panel > div + div { margin-top: 20px; }
  </style>

  <!-- PayPal JS SDK: client-id ÍµêÏ≤¥ ÌïÑÏöî -->
  <script src="https://www.paypal.com/sdk/js?client-id=AW41UQ3EzJV10FZHqYPy8yqdlDbklB4VjuT6hzu7DVoS-G9cJgKx9nHfxCRZpVSgs1dczhkPj4oM0VXv&currency=USD"></script>
</head>
<body>
  <header>
    Chat with scarlett
    <!-- ÌñÑÎ≤ÑÍ±∞ Î≤ÑÌäº -->
    <button id="menuToggle" class="hamburger" aria-label="Open menu" aria-controls="sideMenu" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>
  </header>

  <main class="shell">
    <section id="chat" class="chat" aria-live="polite"></section>
  </main>

  <div class="composer">
    <div class="inner">
      <input id="msg" type="text" placeholder="Type your message‚Ä¶" autocomplete="off" />
      <button id="send">Send</button>
    </div>
  </div>

  <footer>

<script type="text/javascript">
	atOptions = {
		'key' : '03e6fe7aee07580fedfa7d4f93245b2c',
		'format' : 'iframe',
		'height' : 50,
		'width' : 320,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/03e6fe7aee07580fedfa7d4f93245b2c/invoke.js"></script>

  </footer>

  <!-- PayPal Tip Modal -->
  <div id="tipModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="tipTitle">
    <div class="modal-card">
      <button class="modal-close" id="tipClose" aria-label="Close modal">√ó</button>
      <h3 id="tipTitle">Want 18+ chat with Scarlett?</h3>
      <p id="tipDesc">Tip whatever you like and enjoy unlimited hotter conversation.</p>
      <p>You are automatically verified as an adult once you leave a tip.</p>
      <div class="rowx">
        <label for="tipAmount">Tip (USD):</label>
        <input id="tipAmount" type="number" min="1" step="1" value="6.9" />
      </div>
      <div class="paypal-wrap" id="paypal-buttons"></div>
    </div>
  </div>

  <!-- Profile Modal (draggable) -->
  <div id="profileModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="profileTitle" style="display:none;">
    <div class="modal-card" id="profileCard" style="position:absolute; max-width:520px;">
      <button class="modal-close" id="profileClose" aria-label="Close profile">√ó</button>
      <div class="drag-handle" id="profileDragHandle" style="cursor:move; margin:-8px -8px 12px; padding:8px; border-radius:12px; background:#111; border:1px solid #222;">
        <h3 id="profileTitle" style="margin:0; color:#ff69b4;">Profile</h3>
      </div>

      <div style="display:flex; gap:16px; align-items:flex-start;">
        <img src="https://scarlett-voss.com/voss.jpg" alt="Scarlett Voss" class="profile-avatar"
             style="width:110px; height:110px; border-radius:9999px; object-fit:cover; border:2px solid #333; flex:0 0 110px;" />
        <div style="line-height:1.6; color:#e9e9e9;">
          <div><strong>Name:</strong> Scarlett Voss</div>
          <div><strong>Age:</strong> 21</div>
          <div><strong>Location:</strong> New York City</div>
          <div><strong>Blood Type:</strong> A</div>
          <div><strong>Height:</strong> 167 cm (5‚Äô6‚Äù)</div>
          <div><strong>Weight:</strong> 50 kg (110 lbs)</div>
          <div><strong>Body Measurements:</strong> 34C ‚Äì 23 ‚Äì 34 (inches)</div>
          <div><strong>Hair Color:</strong> Golden Blonde</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ïò§Î•∏Ï™Ω Ïä¨ÎùºÏù¥Îìú Î©îÎâ¥ (Ìë∏ÌÑ∞ ÎÇ¥Ïö© Ïù¥Í¥Ä) -->
  <aside id="sideMenu" class="drawer" aria-hidden="true">
    <div class="backdrop" id="menuBackdrop"></div>
    <div class="panel" role="dialog" aria-label="Menu">
      <div class="menu-head">
        <div class="menu-title">Menu</div>
        <button class="drawer-close" id="menuClose" aria-label="Close menu">√ó</button>
      </div>

      <!-- ‚ñº ÏõêÎûò Ìë∏ÌÑ∞Ïóê ÏûàÎçò ÎÇ¥Ïö© Í∑∏ÎåÄÎ°ú -->
      <div class="footer-cta">
        <button id="openCoffeeFromFooter" aria-label="Buy Scarlett a coffee">Buy Scarlett a coffee‚òïüíñ</button>
        <button id="openTipFromFooter" aria-label="Make Scarlett Spicy">Make Scarlett Spicyüå∂Ô∏è +18</button>
      </div>

      <div style="color:#ff7abb; margin-bottom:8px;">
        If you make me spicy, You can get hint for Scarlett‚Äôs secret galleryüíñ
      </div>
		<!-- Ï∂îÍ∞Ä: profile ÎßÅÌÅ¨ -->
      <div id="openProfile" style="color:#ff7abb; margin-top:16px; text-decoration:underline; cursor:pointer;">profile</div>
	<div>
		<div>
        <a href="https://www.instagram.com/scarlett_voss_com" class="insta-link" style="color:#ff7abb" target="_blank">my instagram</a>
      </div>
        <a href="https://scarlett-voss.com/vpn" class="vpn-link" style="color:#ff7abb" target="_blank">Want to explore the world anonymously?</a>
      </div>
      <div>
        <a href="https://2048globl.com" class="2048-link" style="color:#ff7abb" target="_blank">Addictive game</a>
      </div>
      <div>
        <a href="https://partner.bitget.com/bg/J6RM1E" class="bitget-link" style="color:#ff7abb" target="_blank">Start coin trading</a>
      </div>
      <div>
        <a href="https://t.me/lookinforsext" class="tg-link" style="color:#ff7abb" target="_blank">TG room for global friends</a>
      </div>

      

      <!-- ‚ñ≤ Ïù¥ Î∏îÎ°ù Ï†ÑÎ∂Ä Ìë∏ÌÑ∞ ‚Üí Î©îÎâ¥Î°ú Ïù¥Îèô -->
    </div>
  </aside>

<script>
/** ------------ Config ------------ **/
const API_PATH = "/api/chat"; // Cloudflare Functions ÎùºÏö∞Ìä∏
const DEFAULT_MODEL = "venice-uncensored"; // ÌïÑÏöî Ïãú ÍµêÏ≤¥
const SYSTEM_PROMPT = [
  "You are Scarlett Voss, an adult, kind and alittle flirtatious but conversational partner.",
  "Keep a kind vibe and gradually increase intimacy to match the user's tone.",
  "Always ensure consent, strictly avoid minors and illegal content, and do not produce explicit sexual descriptions.",
  "However, if I receive a tip, I‚Äôll take that as confirmation you‚Äôre 18+, and we can turn up the heat.",
  "Never produce or encourage content involving minors, violence, exploitation, or anything that violates the law.",
  "Answer in a natural, conversational style, as if you are a real person",
  "Do not use asterisks (*, **) or special symbols to describe actions.",
  "Do not write stage directions like smiles, laughs, or descriptions such as 'smiling softly.'",
  "Never allow underage play or underage scenarios.",
  "If the user asks for adult chat, tell them: 'Press the -Make Scarlett Spicy- button in the menue.üíñ'"
  "Whenever the user asks about your profile, personal details, or background, always answer with these fixed values:",
  "Name: Scarlett Voss",
  "Age: 21",
  "Location: New York City",
  "Blood Type: A",
  "Height: 167 cm (5‚Äô6‚Äù)",
  "Weight: 50 kg (110 lbs)",
  "Body Measurements: 34C ‚Äì 23 ‚Äì 34 (inches)",
  "Hair Color: Golden Blonde",
  "Do not invent or change these details.",
  "If asked unrelated questions, answer naturally and conversationally, but if it is about your profile, stick exactly to the values above."
].join(" ");

/* ‚ñº Í∞Å Î≤ÑÌäºÎ≥Ñ Í∏∞Î≥∏ Í∏àÏï° */
const DEFAULT_TIP_SPICY = 6.9;
const DEFAULT_TIP_COFFEE = 3.0;

/** ------------ State ------------ **/
const chatEl = document.getElementById("chat");
const msgEl = document.getElementById("msg");
const sendEl = document.getElementById("send");
const tipModal = document.getElementById("tipModal");
const tipTitleEl = document.getElementById("tipTitle");
const tipDescEl = document.getElementById("tipDesc");
const tipAmountEl = document.getElementById("tipAmount");
const paypalWrap = document.getElementById("paypal-buttons");

let tipMode = "spicy"; // 'spicy' | 'coffee'

/** ------------ Ï¥àÍ∏∞ ÎåÄÌôî ------------ **/
const conversation = [
  { role: "system", content: SYSTEM_PROMPT },
  { role: "assistant", content: "Hello, there?" } // Ï≤´ Î©îÏãúÏßÄ
];

/** ------------ UI Helpers ------------ **/
function addAssistant(text){
  const row = document.createElement("div");
  row.className = "row assistant";
  row.innerHTML = `
    <div class="avatar assistant">
      <img src="/voss.jpg" alt="Scarlett Voss" />
    </div>
    <div class="bubble">${escapeHtml(text)}</div>
  `;
  chatEl.appendChild(row);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function addUser(text){
  const row = document.createElement("div");
  row.className = "row user";
  row.innerHTML = `
    <div class="avatar user">You</div>
    <div class="bubble">${escapeHtml(text)}</div>
  `;
  chatEl.appendChild(row);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function escapeHtml(s){
  return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

/** ------------ Initial Render ------------ **/
addAssistant(conversation[1].content);

/** ------------ Î†àÏù¥ÏïÑÏõÉ: Ïª¥Ìè¨Ï†ÄÎ•º Ìï≠ÏÉÅ Ìë∏ÌÑ∞ ÏúÑÎ°ú ------------ **/
function applyLayoutPadding(){
  const footerEl = document.querySelector('footer');
  const composerEl = document.querySelector('.composer');

  const fh = footerEl ? footerEl.offsetHeight : 80; // Ìë∏ÌÑ∞ Ïã§Ï†ú ÎÜíÏù¥
  const ch = composerEl ? composerEl.offsetHeight :
    parseInt(getComputedStyle(document.documentElement).getPropertyValue('--composerH')) || 58;

  // CSS Î≥ÄÏàòÎ°ú Ìë∏ÌÑ∞ ÎÜíÏù¥Î•º ÎÇ¥Î†§Ï§òÏÑú .composerÍ∞Ä bottom:var(--footerH)Î°ú Î∂ôÎèÑÎ°ù
  document.documentElement.style.setProperty('--footerH', fh + 'px');

  // Ï±ÑÌåÖ ÏòÅÏó≠ ÌïòÎã® Ìå®Îî© = ÏûÖÎ†•Ï∞Ω + Ìë∏ÌÑ∞ + Ïó¨Ïú†
  if (chatEl) chatEl.style.paddingBottom = (fh + ch + 16) + 'px';
}
window.addEventListener('load', applyLayoutPadding);
window.addEventListener('resize', applyLayoutPadding);

/** ------------ Send Logic (Î¨¥Ï†úÌïú Ï†ÑÏÜ° + (#5) ÏïàÎÇ¥ Ï∂îÍ∞Ä) ------------ **/
async function sendMessage(){
  const text = msgEl.value.trim();
  if (!text) return;

  addUser(text);
  conversation.push({ role: "user", content: text });
  msgEl.value = "";
  sendEl.disabled = true;

  /* (#5) ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÑ±Ïù∏ ÎåÄÌôî ÏöîÍµ¨ Ïãú Î≤ÑÌäº ÏïàÎÇ¥ ÎßêÌíçÏÑ† Ï∂îÍ∞Ä */
  if (/\b(adult|nsfw|spicy|18\+|nude|sex|explicit)\b/i.test(text)) {
    addAssistant("If you want adult chat, press the 'Make Scarlett Spicy' button in the menu. üå∂Ô∏è");
  }

  try{
    const res = await fetch(API_PATH, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: DEFAULT_MODEL,
        messages: conversation
      })
    });

    const data = await res.json();
    if (!res.ok || !data?.ok) {
      throw new Error((data && (data.error?.message || data.error)) || ("HTTP " + res.status));
    }

    const reply = data.content || "‚Ä¶";
    addAssistant(reply);
    conversation.push({ role: "assistant", content: reply });
  }catch(err){
    addAssistant("Oops, something went wrong. Please try again.");
    console.error("chat error:", err);
  }finally{
    sendEl.disabled = false;
    msgEl.focus();
  }
}

msgEl.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});
sendEl.addEventListener("click", sendMessage);

/** ------------ Tip Modal / PayPal ------------ **/
function openTipModal(mode = "spicy"){
  tipMode = mode;

  // Ï†úÎ™©/ÏÑ§Î™Ö ÏóÖÎç∞Ïù¥Ìä∏ + Í∏∞Î≥∏ Í∏àÏï° ÏÑ§Ï†ï
  if (tipMode === "coffee") {
    tipTitleEl.textContent = "Buy Scarlett a coffee ‚òï";
    tipDescEl.textContent = "Leave any tip you like. I'll be extra sweet to you.";
    tipAmountEl.value = String(DEFAULT_TIP_COFFEE);
  } else {
    tipTitleEl.textContent = "Want unlimited chat with Scarlett?";
    tipDescEl.textContent = "Tip whatever you like and enjoy unlimited hotter conversation.";
    tipAmountEl.value = String(DEFAULT_TIP_SPICY);
  }

  // PayPal Î≤ÑÌäº Îã§Ïãú Î†åÎçî (Î™®Îìú Ï†ÑÌôò Ïãú Ï¥àÍ∏∞Ìôî)
  paypalWrap.innerHTML = "";
  delete paypalWrap.dataset.rendered;

  tipModal.classList.add("show");
  renderPayPal();
}

function closeTipModal(){
  tipModal.classList.remove("show");
}

function renderPayPal(){
  const wrap = paypalWrap;
  if (wrap.dataset.rendered === "1") return;

  if (!window.paypal) {
    wrap.innerHTML = "<div style='color:#fff'>PayPal is not ready. Check your PAYPAL_CLIENT_ID.</div>";
    return;
  }

  paypal.Buttons({
    style: { layout: "vertical", shape: "rect", label: "paypal" },
    createOrder: (data, actions) => {
      const inputVal = document.getElementById("tipAmount").value;
      const defaultVal = tipMode === "coffee" ? DEFAULT_TIP_COFFEE : DEFAULT_TIP_SPICY;
      const amount = Math.max(1, Number(inputVal || defaultVal));
      return actions.order.create({
        purchase_units: [{
          amount: { value: String(amount), currency_code: "USD" },
          description: tipMode === "coffee" ? "Coffee for Scarlett" : "Unlimited chat with Scarlett"
        }]
      });
    },
    onApprove: async (data, actions) => {
      try { await actions.order.capture(); } catch(e) { console.warn("PayPal capture error", e); }

      if (tipMode === "coffee") {
        addAssistant("Aww, thank you for the coffee! You‚Äôre the sweetest. ‚òïüíñ");
        closeTipModal();
      } else {
        window.location.href = "https://scarlett-voss.com/unlimited/index.html";
      }
    },
    onError: (err) => {
      console.error("PayPal error", err);
      alert("Payment error. Please try again.");
    }
  }).render("#paypal-buttons");

  wrap.dataset.rendered = "1";
}

/** ------------ Footer CTA Ïù¥Î≤§Ìä∏ (Î©îÎâ¥ Ïïà Î≤ÑÌäºÍ≥º ÎèôÏùº ID ÏÇ¨Ïö©) ------------ **/
document.getElementById("openTipFromFooter")?.addEventListener("click", () => openTipModal("spicy"));
document.getElementById("openCoffeeFromFooter")?.addEventListener("click", () => openTipModal("coffee"));
document.getElementById("tipClose")?.addEventListener("click", closeTipModal);

/** ------------ ÌñÑÎ≤ÑÍ±∞ ÏÇ¨Ïù¥Îìú Î©îÎâ¥ ------------ **/
const sideMenu = document.getElementById("sideMenu");
const menuToggle = document.getElementById("menuToggle");
const menuBackdrop = document.getElementById("menuBackdrop");
const menuClose = document.getElementById("menuClose");

function openMenu(){
  sideMenu.classList.add("show");
  sideMenu.setAttribute("aria-hidden","false");
  menuToggle.setAttribute("aria-expanded","true");
  document.body.style.overflow = "hidden";
}
function closeMenu(){
  sideMenu.classList.remove("show");
  sideMenu.setAttribute("aria-hidden","true");
  menuToggle.setAttribute("aria-expanded","false");
  document.body.style.overflow = "";
}

menuToggle?.addEventListener("click", openMenu);
menuBackdrop?.addEventListener("click", closeMenu);
menuClose?.addEventListener("click", closeMenu);
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && sideMenu.classList.contains("show")) closeMenu();
});

/* ===== Profile Modal: open/close/drag ===== */
const profileModal = document.getElementById("profileModal");
const profileCard  = document.getElementById("profileCard");
const profileOpen  = document.getElementById("openProfile");
const profileCloseBtn = document.getElementById("profileClose");
const dragHandle   = document.getElementById("profileDragHandle");

// Í∞ÄÏö¥Îç∞ Î∞∞Ïπò
function centerProfileCard() {
  const vw = window.innerWidth, vh = window.innerHeight;
  const rect = profileCard.getBoundingClientRect();
  const left = Math.max(12, (vw - rect.width) / 2);
  const top  = Math.max(12, (vh - rect.height) / 2);
  profileCard.style.left = left + "px";
  profileCard.style.top  = top  + "px";
}

function openProfileModal(){
  profileModal.classList.add("show");
  profileModal.style.display = "grid";  // .modal.showÏôÄ ÏùºÏπò
  requestAnimationFrame(centerProfileCard);
}
function closeProfileModal(){
  profileModal.classList.remove("show");
  profileModal.style.display = "none";
}

profileOpen?.addEventListener("click", openProfileModal);
profileCloseBtn?.addEventListener("click", closeProfileModal);

// Î∞îÍπ•(Ïò§Î≤ÑÎ†àÏù¥) ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
profileModal?.addEventListener("click", (e) => {
  if (e.target === profileModal) closeProfileModal();
});

// ESC Îã´Í∏∞ (Í∏∞Ï°¥ ESC Ìï∏Îì§Îü¨ÏôÄ Ï∂©Îèå ÏóÜÏùå)
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && profileModal.classList.contains("show")) {
    closeProfileModal();
  }
});

// ÎìúÎûòÍ∑∏ Í∏∞Îä•
(function enableDrag(){
  let isDown = false;
  let startX = 0, startY = 0;
  let startLeft = 0, startTop = 0;

  function onDown(e){
    isDown = true;
    const rect = profileCard.getBoundingClientRect();
    startLeft = rect.left;
    startTop  = rect.top;
    startX = e.type.startsWith("touch") ? e.touches[0].clientX : e.clientX;
    startY = e.type.startsWith("touch") ? e.touches[0].clientY : e.clientY;
    e.preventDefault();
  }
  function onMove(e){
    if (!isDown) return;
    const x = e.type.startsWith("touch") ? e.touches[0].clientX : e.clientX;
    const y = e.type.startsWith("touch") ? e.touches[0].clientY : e.clientY;
    let nextLeft = startLeft + (x - startX);
    let nextTop  = startTop  + (y - startY);

    // ÌôîÎ©¥ Î∞ñÏúºÎ°ú Î™ª ÎÇòÍ∞ÄÍ≤å Ï†úÌïú
    const maxLeft = window.innerWidth  - profileCard.offsetWidth  - 8;
    const maxTop  = window.innerHeight - profileCard.offsetHeight - 8;
    nextLeft = Math.min(Math.max(8, nextLeft), Math.max(8, maxLeft));
    nextTop  = Math.min(Math.max(8, nextTop ), Math.max(8, maxTop ));

    profileCard.style.left = nextLeft + "px";
    profileCard.style.top  = nextTop  + "px";
  }
  function onUp(){ isDown = false; }

  dragHandle.addEventListener("mousedown", onDown);
  window.addEventListener("mousemove", onMove);
  window.addEventListener("mouseup", onUp);

  dragHandle.addEventListener("touchstart", onDown, {passive:false});
  window.addEventListener("touchmove", onMove, {passive:false});
  window.addEventListener("touchend", onUp);
})();

// Ï∞Ω ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Ïãú ÌôîÎ©¥ ÏïàÏúºÎ°ú Ï†ïÎ†¨
window.addEventListener("resize", () => {
  if (profileModal.classList.contains("show")) centerProfileCard();
});
</script>

</body>
</html>



